import ai, { GROQ_MODEL } from './groq-client';

async function callGroqWithJSON(systemPrompt: string, userPrompt: string): Promise<any> {
  const response = await ai.chat.completions.create({
    model: GROQ_MODEL,
    messages: [
      { role: 'system', content: systemPrompt },
      { role: 'user', content: userPrompt }
    ],
    temperature: 0.7,
    response_format: { type: 'json_object' }
  });

  const content = response.choices[0]?.message?.content || '{}';
  return JSON.parse(content);
}

async function callGroq(systemPrompt: string, userPrompt: string): Promise<string> {
  const response = await ai.chat.completions.create({
    model: GROQ_MODEL,
    messages: [
      { role: 'system', content: systemPrompt },
      { role: 'user', content: userPrompt }
    ],
    temperature: 0.7
  });

  return response.choices[0]?.message?.content || '';
}

export interface CompetitorAnalysis {
  topKeywords: string[];
  titleSuggestions: string[];
  contentStrategy: string;
  targetAudience: string;
  toneAndStyle: string;
  commonTopics: string[];
  contentGaps: string[];
  competitorUrls?: string[];
  realContentAnalyzed?: boolean;
}

export interface SmartArticleRequest {
  niche: string;
  targetKeywords?: string[];
  count: number;
}

export interface GeneratedArticleIdea {
  title: string;
  keywords: string[];
  category: string;
  outline: string[];
  imageQuery: string;
}

interface WebSearchResult {
  title: string;
  url: string;
  snippet: string;
  content?: string;
}

export async function searchCompetitorContent(
  searchQuery: string
): Promise<{ results: WebSearchResult[]; isRealSearch: boolean }> {
  try {
    console.log(`๐ ุจุญุซ ุนู ูุญุชูู ุงูููุงูุณูู: ${searchQuery}`);
    
    const useRealSearch = process.env.ENABLE_REAL_WEB_SEARCH === 'true';
    
    if (useRealSearch) {
      console.log('โ๏ธ ุงูุจุญุซ ุงูุญูููู ุบูุฑ ููุนู ุญุงููุงู. ูุฑุฌู ุชูููู ENABLE_REAL_WEB_SEARCH=true ูุฅุถุงูุฉ API ููุจุญุซ');
    }
    
    const mockResults: WebSearchResult[] = [
      {
        title: `ุฏููู ุดุงูู ุนู ${searchQuery}`,
        url: 'https://example1.com',
        snippet: `ูุนูููุงุช ููุตูุฉ ุนู ${searchQuery} ูู ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ`,
        content: `ูุฐุง ูุญุชูู ุชุฌุฑูุจู ุนู ${searchQuery}. ูุชุถูู ูุนูููุงุช ุนู ุงูุชุตููู ูุงูุชุฑููุจ ูุงูุตูุงูุฉ. ุงููุญุชูู ูุณุชูุฏู ุฃุตุญุงุจ ุงูููุงุฒู ูุงูุดุฑูุงุช ูู ุฌุฏุฉ ูุงูุฑูุงุถ.`
      },
      {
        title: `ุฃูุถู ุฎูุงุฑุงุช ${searchQuery} ูู ุฌุฏุฉ`,
        url: 'https://example2.com',
        snippet: `ุงูุชุดู ุฃุญุฏุซ ุชุตุงููู ${searchQuery} ูุงูุฎุฏูุงุช ุงููุชููุฒุฉ`,
        content: `ูุตุงุฆุญ ุนูููุฉ ูุงุฎุชูุงุฑ ${searchQuery} ุงูููุงุณุจ. ูุดูู ููุงุฑูุฉ ุงูุฃุณุนุงุฑ ูุงูุฌูุฏุฉ ูุงูููุงุฏ ุงููุณุชุฎุฏูุฉ. ุงูุชุฑููุฒ ุนูู ุงููุชุงูุฉ ูุงูุฌูุฏุฉ ุงูุนุงููุฉ.`
      }
    ];
    
    console.log(`โ ุชู ุงูุนุซูุฑ ุนูู ${mockResults.length} ูุชูุฌุฉ ุจุญุซ ูุญุงูุงุฉ`);
    console.log(`โ๏ธ ููุงุญุธุฉ: ูุชู ุงุณุชุฎุฏุงู ุจูุงูุงุช ูุญุงูุงุฉ ุญุงููุงู`);
    console.log(`   ููุฅูุชุงุฌ: ูู ุจุชุนููู ENABLE_REAL_WEB_SEARCH=true ูุชูุงูู API ุจุญุซ ุญูููู:`);
    console.log(`   - Google Custom Search API`);
    console.log(`   - Bing Search API`);
    console.log(`   - SerpAPI`);
    
    return {
      results: mockResults,
      isRealSearch: false
    };
  } catch (error) {
    console.error('ุฎุทุฃ ูู ุงูุจุญุซ ุนู ูุญุชูู ุงูููุงูุณูู:', error);
    return {
      results: [],
      isRealSearch: false
    };
  }
}

export async function analyzeCompetitors(
  searchQuery: string,
  useWebSearch: boolean = true
): Promise<CompetitorAnalysis> {
  try {
    let competitorContent = '';
    let competitorUrls: string[] = [];
    let isRealSearch = false;
    
    if (useWebSearch) {
      console.log('๐ ูุญุงููุฉ ุงูุจุญุซ ุนู ูุญุชูู ุงูููุงูุณูู...');
      const searchData = await searchCompetitorContent(searchQuery);
      isRealSearch = searchData.isRealSearch;
      
      if (searchData.results.length > 0) {
        if (!isRealSearch) {
          console.log('โ๏ธ ุงุณุชุฎุฏุงู ุจูุงูุงุช ูุญุงูุงุฉ (ูููุณ ุจุญุซ ุญูููู)');
        }
        competitorUrls = searchData.results.map(r => r.url);
        competitorContent = searchData.results
          .map((result, idx) => `
**ูุตุฏุฑ ${idx + 1}**: ${result.title}
**ุงูุฑุงุจุท**: ${result.url}
**ุงููุญุชูู**: ${result.content || result.snippet}
          `)
          .join('\n---\n');
      }
    }
    
    const prompt = useWebSearch && competitorContent ? 
      `ุฃูุช ุฎุจูุฑ ุชุญููู SEO ูููุงูุณูู ูู ุงูุณูู ุงูุณุนูุฏู.
    
ุงููููุฉ: ุชุญููู ุงุณุชุฑุงุชูุฌูุฉ ุงูููุงูุณูู ุงููุนููุฉ ูููุถูุน: "${searchQuery}"

**ูุญุชูู ุงูููุงูุณูู ุงูุญูููู ูู ูุชุงุฆุฌ ุงูุจุญุซ:**
${competitorContent}

ุจูุงุกู ุนูู ุงููุญุชูู ุงููุนูู ููููุงูุณูู ุฃุนูุงูุ ูู ุจุชุญููู ุดุงูู ูุน ุงูุชุฑููุฒ ุนูู:

1. **ุงููููุงุช ุงูููุชุงุญูุฉ ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู**: ุงุณุชุฎุฑุฌ ุฃูู 10-15 ูููุฉ ููุชุงุญูุฉ ูุณุชุฎุฏููุง ุงูููุงูุณูู ูุนููุงู
2. **ุนูุงููู ุฌุฐุงุจุฉ**: ุงูุชุฑุญ 5 ุนูุงููู ูุดุงุจูุฉ ููุง ููุฌุญ ูุน ุงูููุงูุณูู
3. **ุงุณุชุฑุงุชูุฌูุฉ ุงููุญุชูู**: ููู ููุฏู ุงูููุงูุณูู ุงููุญุชููุ (ุชุนููููุ ุชุณููููุ ููุงุฑูุงุชุ ุฅูุฎ)
4. **ุงูุฌูููุฑ ุงููุณุชูุฏู**: ูู ูู ุงูุฌูููุฑ ุงูุฐู ูุณุชูุฏูู ุงูููุงูุณููุ
5. **ูุจุฑุฉ ูุฃุณููุจ ุงููุชุงุจุฉ**: ูุง ูู ุงูุฃุณููุจ ุงูุณุงุฆุฏุ (ุฑุณููุ ูุฏูุ ุชูููุ ุฅูุฎ)
6. **ุงูููุงุถูุน ุงูุดุงุฆุนุฉ**: ูุง ูู ุงูููุงุถูุน ุงููุดุชุฑูุฉ ุจูู ุงูููุงูุณููุ
7. **ุงูุซุบุฑุงุช ูู ุงููุญุชูู**: ูุง ุงูุฐู ูุง ูุบุทูู ุงูููุงูุณูู ุฌูุฏุงูุ

ุงูุณูุงู: ุดุฑูุฉ "ูุญุชุฑููู ุงูุฏูุงุฑ ุงูุนุงูููุฉ" - ุดุฑูุฉ ุณุนูุฏูุฉ ูุชุฎุตุตุฉ ูู:
- ุจุฑุฌููุงุช
- ูุธูุงุช ุณูุงุฑุงุช
- ูุธูุงุช ุญุฏุงุฆู
- ุชูุณูู ุญุฏุงุฆู
- ุฃุนูุงู ุงูุจูุงุก ูู ุฌุฏุฉ

ุฃุฑุฌุน ุงููุชูุฌุฉ ุจุตูุบุฉ JSON ููุท ุจุฏูู ุฃู ูุต ุฅุถุงูู:
{
  "topKeywords": ["ูููุฉ1", "ูููุฉ2", ...],
  "titleSuggestions": ["ุนููุงู1", "ุนููุงู2", ...],
  "contentStrategy": "ูุตู ุงูุงุณุชุฑุงุชูุฌูุฉ",
  "targetAudience": "ูุตู ุงูุฌูููุฑ",
  "toneAndStyle": "ูุตู ุงูุฃุณููุจ",
  "commonTopics": ["ููุถูุน1", "ููุถูุน2", ...],
  "contentGaps": ["ุซุบุฑุฉ1", "ุซุบุฑุฉ2", ...]
}` :
      `ุฃูุช ุฎุจูุฑ ุชุญููู SEO ูููุงูุณูู ูู ุงูุณูู ุงูุณุนูุฏู.
    
ุงููููุฉ: ุชุญููู ุงุณุชุฑุงุชูุฌูุฉ ุงูููุงูุณูู ูููุถูุน: "${searchQuery}"

ูู ุจุชุญููู ุดุงูู ููููุงูุณูู ุงูุฐูู ูุชุตุฏุฑูู ูุชุงุฆุฌ ุงูุจุญุซ ูู Google ููุฐุง ุงูููุถูุนุ ูุน ุงูุชุฑููุฒ ุนูู:

1. **ุงููููุงุช ุงูููุชุงุญูุฉ ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู**: ุญุฏุฏ ุฃูู 10-15 ูููุฉ ููุชุงุญูุฉ ูุณุชุฎุฏููุง ุงูููุงูุณูู
2. **ุนูุงููู ุฌุฐุงุจุฉ**: ุงูุชุฑุญ 5 ุนูุงููู ูุดุงุจูุฉ ููุง ููุฌุญ ูุน ุงูููุงูุณูู
3. **ุงุณุชุฑุงุชูุฌูุฉ ุงููุญุชูู**: ููู ููุฏู ุงูููุงูุณูู ุงููุญุชููุ
4. **ุงูุฌูููุฑ ุงููุณุชูุฏู**: ูู ูู ุงูุฌูููุฑ ุงูุฐู ูุณุชูุฏูู ุงูููุงูุณููุ
5. **ูุจุฑุฉ ูุฃุณููุจ ุงููุชุงุจุฉ**: ูุง ูู ุงูุฃุณููุจ ุงูุณุงุฆุฏุ (ุฑุณููุ ูุฏูุ ุชูููุ ุฅูุฎ)
6. **ุงูููุงุถูุน ุงูุดุงุฆุนุฉ**: ูุง ูู ุงูููุงุถูุน ุงููุดุชุฑูุฉ ุจูู ุงูููุงูุณููุ
7. **ุงูุซุบุฑุงุช ูู ุงููุญุชูู**: ูุง ุงูุฐู ูุง ูุบุทูู ุงูููุงูุณูู ุฌูุฏุงูุ

ุงูุณูุงู: ุดุฑูุฉ "ูุญุชุฑููู ุงูุฏูุงุฑ ุงูุนุงูููุฉ" - ุดุฑูุฉ ุณุนูุฏูุฉ ูุชุฎุตุตุฉ ูู:
- ุจุฑุฌููุงุช
- ูุธูุงุช ุณูุงุฑุงุช
- ูุธูุงุช ุญุฏุงุฆู
- ุชูุณูู ุญุฏุงุฆู
- ุฃุนูุงู ุงูุจูุงุก ูู ุฌุฏุฉ

ุฃุฑุฌุน ุงููุชูุฌุฉ ุจุตูุบุฉ JSON ููุท ุจุฏูู ุฃู ูุต ุฅุถุงูู:
{
  "topKeywords": ["ูููุฉ1", "ูููุฉ2", ...],
  "titleSuggestions": ["ุนููุงู1", "ุนููุงู2", ...],
  "contentStrategy": "ูุตู ุงูุงุณุชุฑุงุชูุฌูุฉ",
  "targetAudience": "ูุตู ุงูุฌูููุฑ",
  "toneAndStyle": "ูุตู ุงูุฃุณููุจ",
  "commonTopics": ["ููุถูุน1", "ููุถูุน2", ...],
  "contentGaps": ["ุซุบุฑุฉ1", "ุซุบุฑุฉ2", ...]
}`;

    const analysis: CompetitorAnalysis = await callGroqWithJSON(
      "ุฃูุช ุฎุจูุฑ ุชุญููู SEO ูููุงูุณูู ูู ุงูุณูู ุงูุณุนูุฏู. ูุฏู ุงุณุชุฌุงุจุฉ JSON ุฏูููุฉ ูููุตูุฉ.",
      prompt
    );
    analysis.competitorUrls = isRealSearch ? competitorUrls : [];
    analysis.realContentAnalyzed = isRealSearch && competitorUrls.length > 0;
    
    return analysis;
  } catch (error) {
    console.error('Error analyzing competitors:', error);
    throw error;
  }
}

export async function generateSmartArticleIdeas(
  analysis: CompetitorAnalysis,
  niche: string,
  count: number = 5
): Promise<GeneratedArticleIdea[]> {
  try {
    const prompt = `ุฃูุช ูุงุชุจ ูุญุชูู ุฎุจูุฑ ููุชุฎุตุต ูู SEO ููุณูู ุงูุณุนูุฏู.

ุจูุงุกู ุนูู ุชุญููู ุงูููุงูุณูู ุงูุชุงูู:
- ุงููููุงุช ุงูููุชุงุญูุฉ: ${analysis.topKeywords.join(', ')}
- ุงูููุงุถูุน ุงูุดุงุฆุนุฉ: ${analysis.commonTopics.join(', ')}
- ุซุบุฑุงุช ุงููุญุชูู: ${analysis.contentGaps.join(', ')}
- ุงูุฌูููุฑ ุงููุณุชูุฏู: ${analysis.targetAudience}
- ุงูุฃุณููุจ: ${analysis.toneAndStyle}

ุงููุฌุงู: ${niche}
ุดุฑูุฉ: "ูุญุชุฑููู ุงูุฏูุงุฑ ุงูุนุงูููุฉ" - ูุชุฎุตุตุฉ ูู ุงูุจุฑุฌููุงุชุ ูุธูุงุช ุงูุณูุงุฑุงุชุ ูุธูุงุช ุงูุญุฏุงุฆูุ ุชูุณูู ุงูุญุฏุงุฆู ูู ุฌุฏุฉ

ุงููุทููุจ: ุชูููุฏ ${count} ุฃููุงุฑ ููุงูุงุช ุฐููุฉ ููุจุชูุฑุฉ ุชุณุชููุฏ ูู ููุงุท ุงูููุฉ ูุชููุฃ ุงูุซุบุฑุงุช.

ููู ููุฑุฉ ููุงูุ ูุฏู:
1. **ุนููุงู ุฌุฐุงุจ**: ูุฌูุน ุจูู ุงููููุงุช ุงูููุชุงุญูุฉ ุงููููุฉ ูุงูุฅุจุฏุงุน
2. **ูููุงุช ููุชุงุญูุฉ**: 5-7 ูููุงุช ููุชุงุญูุฉ ุงุณุชุฑุงุชูุฌูุฉ (ุชุดูู LSI keywords)
3. **ุงูุชุตููู**: ุงุฎุชุฑ ูู (ููุงูุงุช ุชูููุฉุ ูุตุงุฆุญ ูุฅุฑุดุงุฏุงุชุ ุฏุฑุงุณุงุช ุญุงูุฉุ ุฃุฎุจุงุฑ ูุชุญุฏูุซุงุช)
4. **ูุฎุทุท ุงูููุงู**: 5-7 ุนูุงููู ูุฑุนูุฉ ุฑุฆูุณูุฉ
5. **ุงุณุชุนูุงู ุงูุตูุฑุฉ**: ูููุงุช ุจุญุซ ููุงุณุจุฉ ููุนุซูุฑ ุนูู ุตูุฑ ุฐุงุช ุตูุฉ

ูุนุงููุฑ ูููุฉ:
- ุงุณุชุฎุฏู ุฃุณููุจ ${analysis.toneAndStyle}
- ุงุณุชูุฏู ${analysis.targetAudience}
- ุงููุฃ ุซุบุฑุงุช ุงููุญุชูู: ${analysis.contentGaps.join(', ')}
- ุงุณุชุฎุฏู ูููุงุช ููุชุงุญูุฉ ุฐุงุช ุตูุฉ ุจุงูุณูู ุงูุณุนูุฏู

ุฃุฑุฌุน ุงููุชูุฌุฉ ุจุตูุบุฉ JSON ููุท ุจุฏูู ุฃู ูุต ุฅุถุงูู:
[
  {
    "title": "ุงูุนููุงู ุจุงูุนุฑุจูุฉ",
    "keywords": ["ูููุฉ1", "ูููุฉ2", ...],
    "category": "ุงูุชุตููู",
    "outline": ["ุนููุงู ูุฑุนู 1", "ุนููุงู ูุฑุนู 2", ...],
    "imageQuery": "ูููุงุช ุจุญุซ ุงูุตูุฑ"
  }
]`;

    const result = await callGroqWithJSON(
      "ุฃูุช ุฎุจูุฑ ุชุญููู SEO ูููุงูุณูู ูู ุงูุณูู ุงูุณุนูุฏู. ูุฏู ุงุณุชุฌุงุจุฉ JSON ุฏูููุฉ ูููุตูุฉ.",
      prompt
    );
    
    const ideas: GeneratedArticleIdea[] = Array.isArray(result) ? result : (result.ideas || []);
    return ideas.slice(0, count);
  } catch (error) {
    console.error('Error generating article ideas:', error);
    throw error;
  }
}

export async function generateHumanLikeContent(
  idea: GeneratedArticleIdea,
  analysis: CompetitorAnalysis
): Promise<string> {
  try {
    const prompt = `ุฃูุช ูุงุชุจ ูุญุชูู ูุญุชุฑู ููุชุฎุตุต ูู ูุชุงุจุฉ ููุงูุงุช SEO ุจุฃุณููุจ ุจุดุฑู ุทุจูุนู ูุฌุฐุงุจ.

ูุนูููุงุช ุงูููุงู:
- ุงูุนููุงู: ${idea.title}
- ุงููููุงุช ุงูููุชุงุญูุฉ: ${idea.keywords.join(', ')}
- ุงููุฎุทุท: ${idea.outline.join(' | ')}

ูุนูููุงุช ุงูุฃุณููุจ ูู ุชุญููู ุงูููุงูุณูู:
- ุงูุฃุณููุจ: ${analysis.toneAndStyle}
- ุงูุฌูููุฑ ุงููุณุชูุฏู: ${analysis.targetAudience}
- ุงุณุชุฑุงุชูุฌูุฉ ุงููุญุชูู: ${analysis.contentStrategy}

ุงูุณูุงู: ุดุฑูุฉ "ูุญุชุฑููู ุงูุฏูุงุฑ ุงูุนุงูููุฉ" - ุดุฑูุฉ ุณุนูุฏูุฉ ุฑุงุฆุฏุฉ ูู:
- ุชุตููู ูุชุฑููุจ ุงูุจุฑุฌููุงุช ุงูุนุตุฑูุฉ
- ูุธูุงุช ุงูุณูุงุฑุงุช ุจุฃุญุฏุซ ุงูุชุตุงููู
- ูุธูุงุช ุงูุญุฏุงุฆู ุงููุงุฎุฑุฉ
- ุชูุณูู ุงูุญุฏุงุฆู ูุงููุณุงุญุงุช ุงูุฎุถุฑุงุก
- ุฎุฏูุงุช ุงูุจูุงุก ูุงูุชุดููุฏ ูู ุฌุฏุฉ

ุงููุทููุจ: ูุชุงุจุฉ ููุงู ูุชูุงูู (800-1200 ูููุฉ) ูุชููุฒ ุจู:

๐ **ุงูุฃุณููุจ ุงูุจุดุฑู ุงูุทุจูุนู**:
- ุงุณุชุฎุฏู ุฌูู ูุชููุนุฉ (ูุตูุฑุฉุ ูุชูุณุทุฉุ ุทูููุฉ)
- ุฃุถู ููุณุงุช ุดุฎุตูุฉ ูุชุฌุงุฑุจ ูุงูุนูุฉ
- ุงุณุชุฎุฏู ุฃูุซูุฉ ูุญููุฉ ูู ุฌุฏุฉ ูุงูุณุนูุฏูุฉ
- ุงูุชุจ ูุฃูู ุชุชุญุฏุซ ุฅูู ุตุฏูู ูุชุฎุตุต

โจ **ุงูุชููุฒ ุนู ุงูููุงูุณูู**:
- ูุฏู ูุนูููุงุช ูุฑูุฏุฉ ููููุฉ
- ุฃุถู ูุตุงุฆุญ ุนูููุฉ ูููู ุชุทุจูููุง
- ุงุณุชุฎุฏู ุจูุงูุงุช ูุฃุฑูุงู ุนูุฏูุง ูููู ุฐูู ููููุงู
- ุงุฑุจุท ุงููุญุชูู ุจุงููุงูุน ุงูุณุนูุฏู (ุงูุทูุณุ ุงูุซูุงูุฉุ ุงูุนุงุฏุงุช)

๐ฏ **ุงูุชุญุณูู ููุญุฑูุงุช ุงูุจุญุซ**:
- ูุฒุน ุงููููุงุช ุงูููุชุงุญูุฉ ุจุดูู ุทุจูุนู
- ุงุณุชุฎุฏู ุงูุนูุงููู ุงููุฑุนูุฉ ูู ุงููุฎุทุท
- ุฃุถู ุฃุณุฆูุฉ ูุฃุฌูุจุฉ ูู ุงููุต
- ุงุณุชุฎุฏู ูููุงุช ุงูุชูุงููุฉ (ุนูุงูุฉ ุนูู ุฐููุ ุจุงูุฅุถุงูุฉ ุฅููุ ูู ุฌูุฉ ุฃุฎุฑู)

๐ **ุงูุจููุฉ**:
1. ููุฏูุฉ ุฌุฐุงุจุฉ (100-150 ูููุฉ)
2. ุงูุนูุงููู ุงููุฑุนูุฉ ุญุณุจ ุงููุฎุทุท
3. ููุฑุงุช ูุชูุงุฒูุฉ (50-100 ูููุฉ ููู ููุฑุฉ)
4. ุฎุงุชูุฉ ูููุฉ ูุน ุฏุนูุฉ ููุนูู (CTA)

โ๏ธ **ุชุฌูุจ**:
- ุงูููุงู ุงูุฅูุดุงุฆู ุงูุนุงู
- ุงูุชูุฑุงุฑ ุงูููู
- ุงูุฃุณููุจ ุงูุฌุงู ูุงูุฑุณูู ุฌุฏุงู
- ุงููุจุงูุบุงุช ุบูุฑ ุงููุงูุนูุฉ

ุฃูุชุจ ุงูููุงู ุจุตูุบุฉ HTML ูุธููุฉ ูุน ุงุณุชุฎุฏุงู:
- <h2> ููุนูุงููู ุงููุฑุนูุฉ ุงูุฑุฆูุณูุฉ
- <h3> ููุนูุงููู ุงููุฑุนูุฉ ุงูุซุงูููุฉ
- <p> ููููุฑุงุช
- <ul> ู <li> ููููุงุฆู
- <strong> ููุชุฃููุฏ ุนูู ุงูููุงุท ุงููููุฉ

ุงุจุฏุฃ ูุจุงุดุฑุฉ ุจุงููุญุชูู ุจุฏูู ุฃู ูุต ุชูููุฏู:`;

    const content = await callGroq(
      "ุฃูุช ูุงุชุจ ูุญุชูู ูุญุชุฑู ููุชุฎุตุต ูู ูุชุงุจุฉ ููุงูุงุช SEO ุจุฃุณููุจ ุจุดุฑู ุทุจูุนู ูุฌุฐุงุจ.",
      prompt
    );
    
    return content.trim();
  } catch (error) {
    console.error('Error generating human-like content:', error);
    throw error;
  }
}

export async function generateOptimizedMetaTags(
  title: string,
  keywords: string[],
  analysis: CompetitorAnalysis
): Promise<{ metaTitle: string; metaDescription: string }> {
  try {
    const prompt = `ุฃูุช ุฎุจูุฑ SEO ูุชุฎุตุต ูู ุชุญุณูู Meta Tags.

ุนููุงู ุงูููุงู: ${title}
ุงููููุงุช ุงูููุชุงุญูุฉ: ${keywords.join(', ')}
ุงูุฃุณููุจ ุงููุณุชูุฏู: ${analysis.toneAndStyle}
ุงูุฌูููุฑ: ${analysis.targetAudience}

ุงููุทููุจ: ุฅูุดุงุก Meta Title ู Meta Description ูุญุณููู ููุญุฑูุงุช ุงูุจุญุซ:

**Meta Title**:
- ุงูุทูู: 50-60 ุญุฑู
- ูุญุชูู ุนูู ุงููููุฉ ุงูููุชุงุญูุฉ ุงูุฃุณุงุณูุฉ
- ุฌุฐุงุจ ููุญูุฒ ุนูู ุงูููุฑ
- ูุนูุณ ูุญุชูู ุงูููุงู ุจุฏูุฉ

**Meta Description**:
- ุงูุทูู: 150-160 ุญุฑู
- ูุญุชูู ุนูู 2-3 ูููุงุช ููุชุงุญูุฉ
- ูุฌูุจ ุนูู ุณุคุงู ุงููุณุชุฎุฏู
- ูุญุชูู ุนูู ุฏุนูุฉ ููุนูู (CTA)
- ุทุจูุนู ูุฌุฐุงุจ

ุฃุฑุฌุน ุงููุชูุฌุฉ ุจุตูุบุฉ JSON ููุท:
{
  "metaTitle": "ุงูุนููุงู ุงููุญุณู",
  "metaDescription": "ุงููุตู ุงููุญุณู"
}`;

    const result = await callGroqWithJSON(
      "ุฃูุช ุฎุจูุฑ ุชุญููู SEO ูููุงูุณูู ูู ุงูุณูู ุงูุณุนูุฏู. ูุฏู ุงุณุชุฌุงุจุฉ JSON ุฏูููุฉ ูููุตูุฉ.",
      prompt
    );
    
    return result;
  } catch (error) {
    console.error('Error generating meta tags:', error);
    throw error;
  }
}
